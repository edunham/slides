\documentclass{beamer}
%\usepackage{hyperref}
\usetheme{Goettingen}
%\beamerdefaultoverlayspecification{<+->}

%gets rid of bottom navigation bars
\setbeamertemplate{footline}[text line]{\url{http://talks.edunham.net/lca2018/should-you-rewrite-in-rust/}}

%gets rid of navigation symbols
\setbeamertemplate{navigation symbols}{}


\title{Should you rewrite in Rust?}
\subtitle{talks.edunham.net/lca2018/rust}
\author{$@$qedunham}
\institute{LinuxConf Australia}
\date{\today}
\begin{document}

\begin{frame}[fragile]
\titlepage
\end{frame}


\section{Intro}

\begin{frame}[fragile]
\frametitle{Pop Quiz}
\begin{itemize}[<+(1)->]
\item Do you know what I'm here to tell you?
\item "Rewrite your code!"
\item "Don't rewrite your code!"
\end{itemize}
\end{frame}


\begin{frame}[fragile]
\frametitle{About Me}
\begin{itemize}[<+(1)->]
\item DevOps at Mozilla Research
\item Rust, Servo, VR
\item Rust Community Team
\item Opinions mine, formed through research
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{Outline}
\tableofcontents[pausesections]
\end{frame}

\section{Should you rewrite?}

\begin{frame}[fragile]
\tableofcontents[currentsection]
\end{frame}

\begin{frame}[fragile]
\frametitle{I assume}
\begin{itemize}[<+(1)->]
\item You're working on some code.
\item People help you with the code.
\item People help the project in non-code ways.
\item People use the code.
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{Peoples' \textbf{time} and \textbf{happiness} are valuable.}
\begin{itemize}[<+(1)->]
\item You
\item Colleagues
\item Users
\end{itemize}
\end{frame}

\subsection{Categorizing Rewrites}

\begin{frame}[fragile]
\tableofcontents[currentsubsection]
\end{frame}


\begin{frame}[fragile]
\frametitle{What's a rewrite$?$}
\textbf{Rewriting} is starting anew on a problem that you already have code to
address.

\textbf{Refactoring} is modifying code which tries to solve a problem.
\end{frame}

\begin{frame}[fragile]
\frametitle{Sort rewrites by size}
Smaller \hrulefill Larger

Constrained \hfill Green-field

Few new bugs \hfill YOLO

Quick \hfill Slow

\end{frame}

\begin{frame}[fragile]
\frametitle{Sort rewrites by motive}
\begin{itemize}[<+(1)->]
\item Learn a tool
\item Understand a task
\item Ship production code
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{Rewriting to Understand}
Costs your time:
\begin{itemize}[<+(1)->]
\item Researching
\item Writing
\item Debugging
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{Rewriting to deploy}
Costs everyone's time:
\begin{itemize}[<+(1)->]
\item Researching
\item Writing
\item Debugging
\item Explaining
\item Ensuring backwards compatibility
\item Tooling and automation
\item Fixing new bugs
\item Learning new system
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{Why deploy a rewrite?}
\begin{itemize}[<+(1)->]
\item Improve performance
\item Improve maintainability
\item Increase contributor base
\end{itemize}
\end{frame}

\subsection{Communicating about Code Changes}

\begin{frame}[fragile]
\tableofcontents[currentsubsection]
\end{frame}

\begin{frame}[fragile]
\frametitle{Identify the problem}
\begin{itemize}[<+(1)->]
\item What does the code do?
\item What should it do?
\item What if I don't change it?
\item How would I know if the problem was solved?
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{Where's the problem?}
\begin{itemize}[<+(1)->]
\item Your definitions of what the system does and should do?
\item Architecture and problem definition?
\item Tooling, libraries, dependencies?
\item Code's logic?
\item Code's unintended side effects?
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{Who will the change affect$?$}
\begin{itemize}[<+(1)->]
\item You
\item Other coders
\item Documentation writers
\item Marketers
\item Users
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{Learn from history.}
\begin{itemize}[<+(1)->]
\item Ask people about the proposed solution!
\item Research others' attempts here!
\item Research other projects' attempts!
\item Can you get buy-in$?$ Why or why not$?$
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{Experts prefer small changes.}
\begin{itemize}[<+(1)->]
\item Break big changes into small ones
\item Lowest-cost solution for desired impact
\item Minimize wasted effort
\item Avoid consequences of needless complexity
\item Risks compound.
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{``You should go rewrite your code!"}
What are you saying$?$
\begin{itemize}[<+(1)->]
\item ``You should throw out your hard work!"
\item ``Your work would be easy to replace!"
\item ``You don't understand your own engineering tradeoffs!"
\item ``I don't understand the problem you're trying to solve!"
\end{itemize}
\end{frame}


\begin{frame}[fragile]
\frametitle{How not to troll}
\begin{itemize}[<+(1)->]
\item ``I notice you're getting a lot of issue reports about... "
\item ``Your code has been tested by a lot of users!"
\item ``Would you like a patch which....$?$"
\item ``Where can I learn about other times you've tried to solve this$?$"
\item Why write code a project doesn't want$?$
\end{itemize}
\end{frame}


\subsection{Rewriting to understand}

\begin{frame}[fragile]
\tableofcontents[currentsubsection]
\end{frame}

\subsection{Case studies: Rewriting to understand}

\begin{frame}[fragile]
\frametitle{\insertsubsectionhead}
\begin{itemize}[<+(1)->]
\item Use a familiar task or tool
\item Document what you learn
\item Take lessons home
\end{itemize}
\end{frame}


\begin{frame}[fragile]
\frametitle{\insertsubsectionhead}

``I know Rust and I wonder if it could make Zopfli compression faster"

\url{github.com/carols10cents/rust-out-your-c-talk}

\end{frame}

\begin{frame}[fragile]
\frametitle{\insertsubsectionhead}

``I have some familiar problems and I'd like to practice Rust"

\url{github.com/BartMassey/advent-of-code-2016}

\end{frame}


\section{Rewriting to deploy}

\begin{frame}[fragile]
\tableofcontents [currentsection]
\end{frame}

\subsection{What's the smallest change that would solve your problem$?$}

\begin{frame}[fragile]
\tableofcontents[currentsubsection]
\end{frame}

\begin{frame}[fragile]
\frametitle{Can your current language solve the problem?}
\begin{itemize}[<+(1)->]
\item You already know it
\item Minimal new dependencies
\item Rewrite to understand, then apply lessons
\item Extant code describes the problem
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{Would a refactor suffice?}
It's slow...
\begin{itemize}[<+(1)->]
\item Refactor hot code
\item Find a faster implementation
\end{itemize}
It's confusing...
\begin{itemize}[<+(1)->]
\item Fix your docs
\item Prune dead code
\item Simplify and refactor
\item Build and document boundary where you would add code
\end{itemize}
People are bored...
\begin{itemize}[<+(1)->]
\item Recognize contributions publicly
\item Communicate costs of ill-concieved changes
\item Gamify issue fixing
\end{itemize}
\end{frame}

\subsection{Can Rust solve your problem?}

\begin{frame}[fragile]
\tableofcontents[currentsubsection]
\end{frame}


\begin{frame}[fragile]
\frametitle{Rust's goals}
\begin{itemize}[<+(1)->]
\item Memory safety
\item C-like performance
\item Minimal runtime
\item Integration with other languages
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{Rusty choices}
\begin{itemize}[<+(1)->]
\item Stable vs Nightly
\item Safe vs Unsafe
\item Libraries vs Binaries
\item Dynamic vs static linking
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{Rust tools}
\begin{itemize}[<+(1)->]
\item Rustup
\item Cargo, crates.io
\item Rustfmt
\item Clippy
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{Learning Rust?}
\begin{itemize}[<+(1)->]
\item \url{doc.rust-lang.org}
\item \url{http://community.rs/resources}
\item 1:40pm Thursday, Rust Programming Techniques, Nick Cameron
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{Industry lessons}
\begin{itemize}[<+(1)->]
\item Isolate a problem
\item Rewrite to reduce risk
\item Establish deployment workflow
\item Small, expert team
\item Incremental rewrite
\item Educate larger teams later
\end{itemize}
\end{frame}

\subsection{Case study: NPM}

\begin{frame}[fragile]
\frametitle{\insertsubsectionhead}
\begin{itemize}[<+(1)->]
\item \url{github.com/ceejbot/npm-first-rust-service}
\item \url{https://www.youtube.com/watch?v=GCsxYAxw3JQ}
\item Wrote proxy, replaced microservice with Rust version
\end{itemize}
\end{frame}

\subsection{Case study: Project Quantum}

\begin{frame}[fragile]
\frametitle{\insertsubsectionhead}
\begin{itemize}[<+(1)->]
\item \url{http://bholley.net/blog/2017/stylo.html}
\item \url{https://blog.rust-lang.org/2017/11/14/Fearless-Concurrency-In-Firefox-Quantum.html}
\item \url{hacks.mozilla.org/2017/08/inside-a-super-fast-css-engine-quantum-css-aka-stylo/}
\item ``Rebuilding a jet engine in flight"
\end{itemize}
\end{frame}

\subsection{Rewriting vs green field}

\begin{frame}[fragile]
\frametitle{\insertsubsectionhead}
\begin{itemize}[<+(1)->]
\item \url{https://www.rust-lang.org/en-US/friends.html}
\item Dropbox, Habitat, Coursera, etc
\item Rewriting requires backwards compatibility.
\end{itemize}
\end{frame}


\section{Rewriting techniques}

\subsection{FFI from Your Language}

\begin{frame}[fragile]
\tableofcontents[currentsubsection]
\end{frame}


\begin{frame}[fragile]
\frametitle{\insertsubsectionhead}
\begin{itemize}[<+(1)->]
\item Foreign Function Interface
\item Call guest language from host language
\item \url{github.com/alexcrichton/rust-ffi-examples}
\item \url{https://doc.rust-lang.org/book/first-edition/ffi.html}
\item cargo.toml, main.rs, main.pl, Makefile
\end{itemize}
\end{frame}


\begin{frame}[fragile]
\frametitle{cargo.toml}
\begin{verbatim}
[package]
name = "perl-to-rust"
version = "0.1.0"
#modified based on python version
authors = ["Hao Wu <echowuhao@gmail.com>"]

[lib]
name = "double_input"
crate-type = ["dylib"]
\end{verbatim}
\end{frame}


\begin{frame}[fragile]
\frametitle{main.rs}
\begin{verbatim}
#[no_mangle]
pub extern fn double_input(input: i32) -> i32 {
    input * 2
}
\end{verbatim}
\end{frame}


\begin{frame}[fragile]
\frametitle{main.pl}
\begin{verbatim}
use v5.10;
use FFI::Raw;

my $double_input = FFI::Raw->new(
    "target/debug/libdouble_input.so",
    'double_input',
    FFI::Raw::int,    # return value
    FFI::Raw::int     # arg #1
);

my $input  = 4;
my $output = $double_input->call($input);
say $input . " * 2 = " . $output;
\end{verbatim}
\end{frame}

\begin{frame}[fragile]
\frametitle{Makefile}
\begin{verbatim}
ifeq ($(shell uname),Darwin)
    EXT := dylib
else
    EXT := so
endif

all: target/debug/libdouble_input.$(EXT)
    perl src/main.pl

target/debug/libdouble_input.$(EXT): src/lib.rs Cargo.toml
    cargo build

clean:
rm -rf target
\end{verbatim}
\end{frame}


\subsection{Static Linking Rust}

\begin{frame}[fragile]
\tableofcontents[currentsubsection]
\end{frame}


\begin{frame}[fragile]
\frametitle{\insertsubsectionhead}

\begin{itemize}[<+(1)->]
\item \url{doc.rust-lang.org/reference/linkage.html}
\item \url{https://doc.rust-lang.org/1.12.1/book/advanced-linking.html#static-linking}
\item \verb|staticlib| crate type
\item \verb|$ rustc --target=x86_64-unknown-linux-musl foo.rs|
\item Recompile dependencies with musl
\end{itemize}

\end{frame}

\subsection{Optional Tools}

\begin{frame}[fragile]
\tableofcontents[currentsubsection]
\end{frame}


\begin{frame}[fragile]
\frametitle{\insertsubsectionhead}

\begin{itemize}[<+(1)->]
\item \url{usehelix.com}, Ruby
\item \url{github.com/neon-bindings/neon}, Node.js
\item \url{github.com/rust-lang-nursery/rust-bindgen}, C
\end{itemize}

\end{frame}

\section{Q \& A}

\begin{frame}[fragile]
\tableofcontents [currentsection]
\end{frame}

\begin{frame}[fragile]
\frametitle{Questions}
\begin{itemize}[<+(1)->]
\item Your project and mentors
\item Host language docs
\item irc.mozilla.org: \#rust, \#rust-beginners, \#rust-community
\item \url{users.rust-lang.org}
\item \url{www.rust-lang.org/team.html}
\item lca$@$edunham.net
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{Stories}

\begin{itemize}
\item Rewriting code
\item Impact of others' rewrites
\item Fun with Rust
\end{itemize}

\end{frame}

\end{document}
